- name: "Transfer backend files to EC2 and uncompress them"
  unarchive:
    src: ~/backend.zip
    dest: ~/

- name: "Update npm"
  become: true
  shell: |
    cd /home/ubuntu/backend
    npm install -g npm@latest

- name: "Install package dependencies"
  become: true
  shell: |
    cd ~/backend   
    ls -la
    npm install
    npm audit fix --audit-level=critical --force

- name: "Build backend"
  become: true
  shell: |
    cd ~/backend
    npm run build
    
- name: "Run backend"
  become: true
  shell: |
    cd ~/backend
    pm2 start npm --name backend -- start
    pm2 ls